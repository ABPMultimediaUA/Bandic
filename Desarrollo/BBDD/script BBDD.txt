CREATE TABLE "Keyband".Rol (
	id varchar(100) NOT NULL,
	empleado boolean not null,
	PRIMARY KEY (id)
)
WITH (
	OIDS=FALSE
);




CREATE TABLE "Keyband".Usuario (
	dni varchar(12) NOT NULL,
	password varchar(100) NOT NULL,
	nombre varchar(100) NOT NULL,
	apellidos varchar(100) NOT NULL,
	sexo varchar(1) not null,
	pais varchar(100) not null,
	localidad varchar(100) null,
	provincia varchar(100) null,
	empleado boolean not null,
	email varchar(100) not null unique,
	fecha_nacimiento date not null,
	fecha_entrada timestamp not null,
	fecha_salida timestamp not null,
	token varchar(500) null,
	PRIMARY KEY (dni)
)
WITH (
	OIDS=false
);

CREATE TABLE "Keyband".Usuario_rol (
	dni varchar(12) NOT NULL,
	id_rol varchar(100) NOT NULL,
	PRIMARY KEY (dni, id_rol),
	FOREIGN KEY (id_rol) REFERENCES "Keyband".Rol(id),
	FOREIGN KEY (dni) REFERENCES "Keyband".Usuario(dni)
)
WITH (
	OIDS=FALSE
);

CREATE TABLE "Keyband".Estado_pulsera (
	id varchar(100) NOT NULL,
	PRIMARY KEY (id)
)
WITH (
	OIDS=false
);

CREATE TABLE "Keyband".Pulsera (
	id varchar(100) NOT NULL,
	usuario varchar(12)NULL,
	estado_pulsera varchar(100) NOT NULL,
	PRIMARY KEY (id),
	FOREIGN KEY (usuario) REFERENCES "Keyband".usuario(dni),
	FOREIGN KEY (estado_pulsera) REFERENCES "Keyband".Estado_pulsera(id)
)
WITH (
	OIDS=false
);
CREATE TABLE "Keyband".Fecha_acceso (
 hora_entrada timestamp not null,
 PRIMARY KEY (hora_entrada)
)
WITH (
 OIDS=false
);

CREATE TABLE "Keyband".Estancia (
 id varchar(100) NOT NULL,
 capacidad numeric(10) null,
 publica boolean not null,
 descripcion varchar(500) null,
 PRIMARY KEY (id)
)
WITH (
 OIDS=false
);

CREATE TABLE "Keyband".acceso_estancia (
 estancia varchar(100) NOT NULL,
 pulsera varchar(100) NOT NULL,
 hora_entrada timestamp not null,
 hora_salida timestamp null,
 PRIMARY KEY (estancia, pulsera,hora_entrada),
 FOREIGN KEY (estancia) REFERENCES "Keyband".estancia(id),
 FOREIGN KEY (hora_entrada) REFERENCES "Keyband".fecha_acceso(hora_entrada),
 FOREIGN KEY (pulsera) REFERENCES "Keyband".pulsera(id)
)
WITH (
 OIDS=false
);
CREATE TABLE "Keyband".Categoria_producto (
	id varchar(100) NOT NULL,
	comestible boolean not null,
	PRIMARY KEY (id)
)
WITH (
	OIDS=false
);

CREATE TABLE "Keyband".Producto (
	id varchar(100) NOT NULL,
	nombre varchar(100)NOT NULL,
	descripcion varchar(100),
	precio numeric(6,2),
	iva numeric(2),
	tweet varchar(140),
	cantidad_disponible numeric(20),
	categoria_producto varchar(100), 
	estancia varchar(100),
	imagen varchar(100),
	imagen_redes varchar(100),
	PRIMARY KEY (id),
	FOREIGN KEY (categoria_producto) REFERENCES "Keyband".Categoria_producto(id),
	FOREIGN KEY (estancia) REFERENCES "Keyband".Estancia(id)
)
WITH (
	OIDS=false
);

CREATE TABLE "Keyband".asignar_producto (
	usuario varchar(12) NOT NULL,
	producto varchar(100) NOT NULL,
	PRIMARY KEY (usuario, producto),
	FOREIGN KEY (usuario) REFERENCES "Keyband".usuario(dni),
	FOREIGN KEY (producto) REFERENCES "Keyband".producto(id)
)
WITH (
	OIDS=false
);

CREATE TABLE "Keyband".acceso_estancia (
	estancia varchar(100) NOT NULL,
	pulsera varchar(100) NOT NULL,
	hora_entrada timestamp not null,
	hora_salida timestamp not null,
	PRIMARY KEY (estancia, pulsera),
	FOREIGN KEY (estancia) REFERENCES "Keyband".estancia(id),
	FOREIGN KEY (pulsera) REFERENCES "Keyband".pulsera(id)
)
WITH (
	OIDS=false
);

CREATE TABLE "Keyband".tpv (
	id varchar(100) NOT NULL,
	nombre varchar(100),
	descripcion varchar(100),
	PRIMARY KEY (id)
)
WITH (
	OIDS=false
);

CREATE TABLE "Keyband".ticket (
	id varchar(100) NOT NULL,
	usuario varchar(12)not NULL,
	fecha timestamp not null,
	tpv varchar(100),
	foreign key (tpv) REFERENCES "Keyband".tpv(id),
	FOREIGN KEY (usuario) REFERENCES "Keyband".usuario(dni),
	PRIMARY KEY (id)
)
WITH (
	OIDS=false
);

CREATE TABLE "Keyband".linea_ticket (
	id varchar(100) NOT NULL,
	ticket varchar(100) not null,
	producto varchar(100) not null,
	cantidad numeric(10) not null,
	precio numeric(10) not null,
	FOREIGN KEY (ticket) REFERENCES "Keyband".ticket(id),
	FOREIGN KEY (producto) REFERENCES "Keyband".producto(id),
	PRIMARY KEY (id)
)
WITH (
	OIDS=false
);


CREATE TABLE "Keyband".Permiso (
	id varchar(100) NOT NULL,
	descricpion varchar(500) NOT NULL,
	PRIMARY KEY (id)
)
WITH (
	OIDS=false
);

CREATE TABLE "Keyband".Permisos_rol (
	id_rol varchar(100) NOT NULL,
	id_permiso varchar(100) NOT NULL,
	FOREIGN KEY (id_rol) REFERENCES "Keyband".Rol(id),
	FOREIGN KEY (id_permiso) REFERENCES "Keyband".Permiso(id),
	PRIMARY KEY (id_rol, id_permiso)
)
WITH (
	OIDS=false
);

/*ROL*/
insert into "Keyband".rol values('Cliente',false);
/*USUARIO*/
insert into "Keyband".usuario values('48764260M','blabla123','Alberto','García Garabal','m','España','Alicante','Alicante','Cliente',false,'alberto95-rm@hotmail.com','1995-04-10','2016-04-10','2016-08-10',null);
insert into "Keyband".usuario values('73874534M','blabla123','Pepe','García Garabal','m','España','Alicante','Alicante','Empleado',false,'pepeeeeerm@hotmail.com','1995-04-10','2016-04-10','2016-08-10',null);
/*CATEGORIA PRODUCTO*/
insert into "Keyband".categoria_producto values('Alimentacion', true);
insert into "Keyband".categoria_producto values('Masajes', false);
insert into "Keyband".categoria_producto values('Deporte', false);
insert into "Keyband".categoria_producto values('Otros servicios', false);
insert into "Keyband".categoria_producto values('Excursiones', false);
/*PRODUCTO*/
insert into "Keyband".producto values('1','Coca-cola','Refresco con cafeina',2.3,21,'Tomando una coca-cola refrescante en Altea Hills',20,'Alimentacion',null,null,null);
insert into "Keyband".producto values('2','Masaje de pies','Relajante masaje de pies de los mejores profesionales',5.5,21,'Masajico de pies en Altea Hills',null,'Masajes',null,null,null);
insert into "Keyband".producto values('3','Fanta naranja','Refresco sabor naranja, con gas',2.0,21,'Tomando una fanta de naranja refrescante en Altea Hills',20,'Alimentacion',null,null,null);
insert into "Keyband".producto values('4','Excursión a Roma','Excursión al casco antiguo de Roma',20.0,0,'Hoy nos vamos a Roma',null,'Excursiones',null,'roma.jpg','roma.jpg');
/*TICKET*/
insert into "Keyband".ticket values('1','48764260M','2016-04-10','1');
/*LINEA TICKET*/
insert into "Keyband".linea_ticket values('1','1','1',2, 4.6);
insert into "Keyband".linea_ticket values('2','1','3',3, 6);
insert into "Keyband".linea_ticket values('3','1','4',1, 20);
/*TPV*//***/
insert into "Keyband".tpv values('1','tpv barra','tpv de la barra principal del hotel');
insert into "Keyband".rol_permiso values('5077','1');
